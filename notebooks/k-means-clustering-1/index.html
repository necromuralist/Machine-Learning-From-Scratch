<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="K-Means Clustering using random initial points." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>K-Means Clustering 1 | ML From Scratch</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Machine-Learning-From-Scratch/notebooks/k-means-clustering-1/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script><!-- favicons -->
<link href="../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../project-naive-bayes/" rel="prev" title="Project: Naive-Bayes" type="text/html">
<link href="../k-means-clustering-2/" rel="next" title="K-Means Clustering 2" type="text/html">
<meta content="ML From Scratch" property="og:site_name">
<meta content="K-Means Clustering 1" property="og:title">
<meta content="https://necromuralist.github.io/Machine-Learning-From-Scratch/notebooks/k-means-clustering-1/" property="og:url">
<meta content="K-Means Clustering using random initial points." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-04-12T23:19:50-07:00" property="article:published_time">
<meta content="clustering" property="article:tag">
<meta content="project" property="article:tag">
<meta content="unsupervised" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Machine-Learning-From-Scratch/"><span id="blog-title">ML From Scratch</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">Cloistered Monkey</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Machine-Learning-From-Scratch/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" type="text"><input style="visibility: hidden;display:none" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">K-Means Clustering 1</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-04-12T23:19:50-07:00" itemprop="datePublished" title="2020-04-12 23:19">2020-04-12 23:19</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgfaa82db">Beginning</a>
<ul>
<li><a href="#org20da11f">Imports</a>
<ul>
<li><a href="#orgfbe313f">Python</a></li>
<li><a href="#org17a7d42">PyPi</a></li>
<li><a href="#org60e1be9">Coursera Code</a></li>
<li><a href="#org42ebe7a">Others</a></li>
</ul>
</li>
<li><a href="#orgd6a7a37">Set Up</a>
<ul>
<li><a href="#org1082910">Tables</a></li>
<li><a href="#org32ab6d4">Plotting</a></li>
</ul>
</li>
<li><a href="#orgbd5ffb4">The Data</a></li>
</ul>
</li>
<li><a href="#orgfd8ebcd">Middle</a>
<ul>
<li><a href="#orgea9ea3f">Some Plotting</a>
<ul>
<li><a href="#orgacc62a8">Looking at the Distribution</a></li>
</ul>
</li>
<li><a href="#orgc213f25">Coursera's Splitting</a>
<ul>
<li><a href="#org4244896">More on the functions</a></li>
<li><a href="#orga1f542a">init_point</a></li>
</ul>
</li>
<li><a href="#orgeb9328f">Getting Updated Centroids</a>
<ul>
<li><a href="#org34ca9c2">Clusters</a></li>
<li><a href="#org8a1e7b0">Get Centroids</a></li>
<li><a href="#org1d2cb1b">Test the Get Centroids</a></li>
</ul>
</li>
<li><a href="#org7b8968f">The Objective Function</a></li>
<li><a href="#orgbd4ec8a">Getting the Random Indices</a></li>
<li><a href="#org2115bf2">Putting Them All Together</a></li>
<li><a href="#org269dcd4">Running K-means</a></li>
<li><a href="#orga31c6c7">K From Two To Ten</a></li>
</ul>
</li>
<li><a href="#orga71d73d">End</a>
<ul>
<li><a href="#org176b06e">Submissions</a>
<ul>
<li><a href="#org166768b">Plotting the two runs</a></li>
</ul>
</li>
<li><a href="#orgf6415fd">The ID-Specific Data</a>
<ul>
<li><a href="#orgf5033cd">First Check</a></li>
<li><a href="#org1de7558">Second Check</a></li>
</ul>
</li>
<li><a href="#org94b05e5">Sklearn Double check</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgfaa82db">
<h2 id="orgfaa82db">Beginning</h2>
<div class="outline-text-2" id="text-orgfaa82db">
<p>This is part 1 of the K-means clustering project. In this portion we'll implement K-means classification using random starting centroids.</p>
</div>
<div class="outline-3" id="outline-container-org20da11f">
<h3 id="org20da11f">Imports</h3>
<div class="outline-text-3" id="text-org20da11f"></div>
<div class="outline-4" id="outline-container-orgfbe313f">
<h4 id="orgfbe313f">Python</h4>
<div class="outline-text-4" id="text-orgfbe313f">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org17a7d42">
<h4 id="org17a7d42">PyPi</h4>
<div class="outline-text-4" id="text-org17a7d42">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">be_true</span><span class="p">,</span>
    <span class="n">expect</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org60e1be9">
<h4 id="org60e1be9">Coursera Code</h4>
<div class="outline-text-4" id="text-org60e1be9">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">ml_from_scratch.coursera.Precode</span> <span class="kn">import</span> <span class="n">initial_S1</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org42ebe7a">
<h4 id="org42ebe7a">Others</h4>
<div class="outline-text-4" id="text-org42ebe7a">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd6a7a37">
<h3 id="orgd6a7a37">Set Up</h3>
<div class="outline-text-3" id="text-orgd6a7a37"></div>
<div class="outline-4" id="outline-container-org1082910">
<h4 id="org1082910">Tables</h4>
<div class="outline-text-4" id="text-org1082910">
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org32ab6d4">
<h4 id="org32ab6d4">Plotting</h4>
<div class="outline-text-4" id="text-org32ab6d4">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"k-means-clustering-1"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"../files/notebooks/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'matplotlib'</span><span class="p">,</span> <span class="s1">'inline'</span><span class="p">)</span>
<span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span> <span class="s2">"InlineBackend.figure_format = 'retina'"</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">,</span>
            <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">"axes.grid"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">"xtick.labelsize"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s2">"ytick.labelsize"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s2">"font.size"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s2">"font.family"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sans-serif"</span><span class="p">],</span>
                <span class="s2">"font.sans-serif"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Open Sans"</span><span class="p">,</span> <span class="s2">"Latin Modern Sans"</span><span class="p">,</span> <span class="s2">"Lato"</span><span class="p">],</span>
                <span class="s2">"figure.figsize"</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)},</span>
            <span class="n">font_scale</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgbd5ffb4">
<h3 id="orgbd5ffb4">The Data</h3>
<div class="outline-text-3" id="text-orgbd5ffb4">
<div class="highlight">
<pre><span></span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"KNN_DATA"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(300, 2)
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgfd8ebcd">
<h2 id="orgfd8ebcd">Middle</h2>
<div class="outline-text-2" id="text-orgfd8ebcd"></div>
<div class="outline-3" id="outline-container-orgea9ea3f">
<h3 id="orgea9ea3f">Some Plotting</h3>
<div class="outline-text-3" id="text-orgea9ea3f"></div>
<div class="outline-4" id="outline-container-orgacc62a8">
<h4 id="orgacc62a8">Looking at the Distribution</h4>
<div class="outline-text-4" id="text-orgacc62a8">
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#plot = frame.plot.kde()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Data Distribution"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="data_distribution.png" src="data_distribution.png"></p>
</div>
<p>It looks like there might be at least three sub-populations there.</p>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"X vs Y"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="scatter.png" src="scatter.png"></p>
</div>
<p>Well, this makes it look like there's four to six groups.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc213f25">
<h3 id="orgc213f25">Coursera's Splitting</h3>
<div class="outline-text-3" id="text-orgc213f25">
<p>The <code>initial_S1</code> function appears to be an example function that returns <i>k</i> and the initial centroids that were randomly chosen for the data. It uses <code>k=3</code> and <code>k=5</code>.</p>
<div class="highlight">
<pre><span></span><span class="n">STUDENT_ID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"STUDENT_ID"</span><span class="p">]</span>
<span class="n">INDEX_ID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">STUDENT_ID</span><span class="p">)</span> <span class="o">%</span> <span class="mi">150</span> 
<span class="c1"># please replace 0111 with your last four digit of your ID</span>
<span class="n">k1</span><span class="p">,</span> <span class="n">i_point1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">i_point2</span> <span class="o">=</span> <span class="n">initial_S1</span><span class="p">(</span><span class="n">STUDENT_ID</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"K=</span><span class="si">{</span><span class="n">k1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i_point1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">K=</span><span class="si">{</span><span class="n">k2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i_point2</span><span class="p">)</span>
</pre></div>
<pre class="example">
Strategy 1: k and initial points
K=3
[[3.79752017 0.69134312]
 [3.81485895 6.91844078]
 [2.25790845 7.44778003]]

K=5
[[9.26998864 9.62492869]
 [6.05509889 7.23007608]
 [7.74867074 1.71812324]
 [7.25412082 2.77862318]
 [7.57805025 3.82487017]]
</pre>
<p>So for the initialization it appears we don't have to implement anything other than something that calls <code>initial_point_idx(id, k, N)</code> and <code>init_point(data, idx)</code>.</p>
<p><b>Note:</b> On re-reading the notes it appears these values are for the submission only. To implement k-means for the plotting we need to use random values (the function to get the index sets the seed so it returns the same values every time.)</p>
</div>
<div class="outline-4" id="outline-container-org4244896">
<h4 id="org4244896">More on the functions</h4>
<div class="outline-text-4" id="text-org4244896">
<p>Since there's no real documentation for it I thought I should note what the signatures are for the functions.</p>
</div>
<ul class="org-ul">
<li><a id="org12e8767"></a>initial_point_idx<br>
<div class="outline-text-5" id="text-org12e8767">
<p>This function creates an array of indices for the centroids using <a href="https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.random.permutation.html">numpy.random.permutation</a>. In this case we're passing it the number of rows in the data so it's permuting an <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.arange.html">arange</a> - integers from 0 to number of rows - 1.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Argument</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">id</td>
<td class="org-left">The student ID passed in</td>
</tr>
<tr>
<td class="org-left">k</td>
<td class="org-left">The number of centroids to create</td>
</tr>
<tr>
<td class="org-left">N</td>
<td class="org-left">The number of rows in the data</td>
</tr>
</tbody>
</table>
<p>It returns the array of random indices it created.</p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orga1f542a">
<h4 id="orga1f542a">init_point</h4>
<div class="outline-text-4" id="text-orga1f542a">
<p>This converts the indices created by <code>initial_point_idx</code> and retrieves the actual points from the data.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Argument</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">data</td>
<td class="org-left">Our array of points.</td>
</tr>
<tr>
<td class="org-left">idx</td>
<td class="org-left">An array of indices for the data</td>
</tr>
</tbody>
</table>
<p>It returns the array of coordinates for the initial centroids.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgeb9328f">
<h3 id="orgeb9328f">Getting Updated Centroids</h3>
<div class="outline-text-3" id="text-orgeb9328f"></div>
<div class="outline-4" id="outline-container-org34ca9c2">
<h4 id="org34ca9c2">Clusters</h4>
<div class="outline-text-4" id="text-org34ca9c2">
<p>This is just a namedtuple to hold the clusters and centroids.</p>
<div class="highlight">
<pre><span></span><span class="n">Clusters</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Clusters"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"clusters"</span><span class="p">,</span> <span class="s2">"centroids"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8a1e7b0">
<h4 id="org8a1e7b0">Get Centroids</h4>
<div class="outline-text-4" id="text-org8a1e7b0">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">update_centroids</span><span class="p">(</span><span class="n">centroids</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Clusters</span><span class="p">:</span>
    <span class="sd">"""Get updated centroids</span>

<span class="sd">    Args:</span>
<span class="sd">     centroids: previous set of centroids</span>
<span class="sd">     points: points to cluster (shape = n rows, 2 columns)</span>

<span class="sd">    Returns:</span>
<span class="sd">     Clusters namedtuple</span>
<span class="sd">    """</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="n">centroids</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">closest</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
        <span class="n">clusters</span><span class="p">[</span><span class="n">closest</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">centroids</span><span class="p">),</span> <span class="sa">f</span><span class="s2">"clusters: </span><span class="si">{</span><span class="n">clusters</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">centroids</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">Clusters</span><span class="p">(</span><span class="n">centroids</span><span class="o">=</span><span class="n">centroids</span><span class="p">,</span> <span class="n">clusters</span><span class="o">=</span><span class="n">clusters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1d2cb1b">
<h4 id="org1d2cb1b">Test the Get Centroids</h4>
<div class="outline-text-4" id="text-org1d2cb1b">
<p>Feature: A function to get updated centroids</p>
<p>Scenario: Updated centroids are retrieved Given an array of points</p>
<div class="highlight">
<pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">])</span>
</pre></div>
<p>And some initial centroids</p>
<div class="highlight">
<pre><span></span><span class="n">centroids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">test</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>
</pre></div>
<p>When the update centroids are retrieved</p>
<div class="highlight">
<pre><span></span><span class="n">updated</span> <span class="o">=</span> <span class="n">update_centroids</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="n">centroids</span><span class="o">=</span><span class="n">centroids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">centroids</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">expect</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">centroids</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">centroids</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">centroids</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
<pre class="example">
[[0.5 0.5]
 [3.5 3.5]]
False
</pre>
<div class="highlight">
<pre><span></span><span class="n">update_2</span> <span class="o">=</span> <span class="n">update_centroids</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
                            <span class="n">centroids</span><span class="o">=</span><span class="n">updated</span><span class="o">.</span><span class="n">centroids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">update_2</span><span class="o">.</span><span class="n">centroids</span><span class="p">)</span>
</pre></div>
<pre class="example">
[[0.5 0.5]
 [3.5 3.5]]
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7b8968f">
<h3 id="org7b8968f">The Objective Function</h3>
<div class="outline-text-3" id="text-org7b8968f">
<p>The objective of training is to minimize the variation within a cluster. In this case we're measuring that as the sum of the squared distances from the points within a cluster to the mean of the cluster.</p>
<p>\[ \sum_{i=1}^K \sum_{x \in D_i} \lVert x - \mu_i \rVert^2 \]</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">clusters</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""calculates the variation within clusters</span>

<span class="sd">    Args:</span>
<span class="sd">     clusters: array (or other iterable of points in the clusters)</span>

<span class="sd">    Returns:</span>
<span class="sd">     the score for the cluster variation</span>
<span class="sd">    """</span>
    <span class="n">variation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
        <span class="n">variation</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
                    <span class="n">cluster</span> <span class="o">-</span> <span class="n">center</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">variation</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">variation</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">clusters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">variation</span><span class="p">)</span>
</pre></div>
<pre class="example">
2.0
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgbd4ec8a">
<h3 id="orgbd4ec8a">Getting the Random Indices</h3>
<div class="outline-text-3" id="text-orgbd4ec8a">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">random_points</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="sd">"""Gets random points from the data</span>

<span class="sd">    Args:</span>
<span class="sd">     k: number of points to get</span>
<span class="sd">     data: the source of the points</span>

<span class="sd">    Returns:</span>
<span class="sd">     k randomly selected points from the data</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))[:</span><span class="n">k</span><span class="p">],</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2115bf2">
<h3 id="org2115bf2">Putting Them All Together</h3>
<div class="outline-text-3" id="text-org2115bf2">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">k_means</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
            <span class="n">centroids</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Clusters</span><span class="p">:</span>
    <span class="sd">"""Calculates the k-means clusters and the variance</span>


<span class="sd">    Args:</span>
<span class="sd">     k: number of clusters to create</span>
<span class="sd">     data: the source of the points to cluster</span>
<span class="sd">     initial_centroids: pre-chosen initial centroids (otherwise random)</span>
<span class="sd">    """</span>
    <span class="n">centroids</span> <span class="o">=</span> <span class="p">(</span><span class="n">centroids</span> <span class="k">if</span> <span class="n">centroids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                 <span class="k">else</span> <span class="n">random_points</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">centroids</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">update_centroids</span><span class="p">(</span><span class="n">centroids</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">centroids</span><span class="p">)</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">centroids</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">break</span>
        <span class="n">centroids</span> <span class="o">=</span> <span class="n">updated</span><span class="o">.</span><span class="n">centroids</span>
    <span class="k">return</span> <span class="n">updated</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org269dcd4">
<h3 id="org269dcd4">Running K-means</h3>
<div class="outline-text-3" id="text-org269dcd4">
<div class="highlight">
<pre><span></span><span class="n">outcome</span> <span class="o">=</span> <span class="n">k_means</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="p">(</span><span class="n">outcome</span><span class="o">.</span><span class="n">clusters</span><span class="p">))</span>
</pre></div>
<pre class="example">
Clusters(clusters=array([[[0, 0],
        [1, 1]],

       [[3, 3],
        [4, 4]]]), centroids=array([[0.5, 0.5],
       [3.5, 3.5]]))
2.0
</pre></div>
</div>
<div class="outline-3" id="outline-container-orga31c6c7">
<h3 id="orga31c6c7">K From Two To Ten</h3>
<div class="outline-text-3" id="text-orga31c6c7">
<div class="highlight">
<pre><span></span><span class="n">Outcomes</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Outcomes"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"losses"</span><span class="p">,</span> <span class="s2">"points"</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">grid_search</span><span class="p">(</span><span class="n">minimum_k</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">maximum_k</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Outcomes</span><span class="p">:</span>
    <span class="sd">"""Runs K-means over a range of K"""</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minimum_k</span><span class="p">,</span> <span class="n">maximum_k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">outcome</span> <span class="o">=</span> <span class="n">k_means</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">outcome</span><span class="o">.</span><span class="n">clusters</span><span class="p">)</span>
        <span class="n">losses</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss</span>
        <span class="n">outcomes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">losses</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                   <span class="n">Loss</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">losses</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="k">return</span> <span class="n">Outcomes</span><span class="p">(</span><span class="n">losses</span><span class="o">=</span><span class="n">losses</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">outcomes</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">outcomes</span> <span class="o">=</span> <span class="n">grid_search</span><span class="p">()</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">outcomes</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"K"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Loss"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Loss by K"</span><span class="p">)</span>
<span class="n">embedded</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"loss_vs_k"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">outcomes</span><span class="o">.</span><span class="n">losses</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">K</th>
<th class="org-right" scope="col">Loss</th>
<th class="org-left" scope="col">Run</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">2833.41</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">2583.06</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">2191.43</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">2026.99</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">2046.6</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">7</td>
<td class="org-right">1896.79</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">8</td>
<td class="org-right">1891.98</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">9</td>
<td class="org-right">1889.84</td>
<td class="org-left">First</td>
</tr>
<tr>
<td class="org-right">10</td>
<td class="org-right">1873.27</td>
<td class="org-left">First</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="loss_vs_k.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object>
<div class="highlight">
<pre><span></span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
<span class="n">ten_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">outcomes</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">centroids</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">plot_clusters</span><span class="p">(</span><span class="n">outcomes</span><span class="p">:</span> <span class="n">Outcomes</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
    <span class="n">center_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">outcomes</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">centroids</span><span class="p">,</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>

    <span class="n">plots</span> <span class="o">=</span> <span class="n">center_frame</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">"+"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">clusters</span><span class="p">:</span>
        <span class="n">c_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
        <span class="n">plots</span> <span class="o">*=</span> <span class="n">c_frame</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span>

    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Clusters K=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">"clusters_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">embedded</span> <span class="o">=</span> <span class="n">plot_clusters</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="clusters_10.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-orga71d73d">
<h2 id="orga71d73d">End</h2>
<div class="outline-text-2" id="text-orga71d73d"></div>
<div class="outline-3" id="outline-container-org176b06e">
<h3 id="org176b06e">Submissions</h3>
<div class="outline-text-3" id="text-org176b06e"></div>
<div class="outline-4" id="outline-container-org166768b">
<h4 id="org166768b">Plotting the two runs</h4>
<div class="outline-text-4" id="text-org166768b">
<div class="highlight">
<pre><span></span><span class="n">outcomes_2</span> <span class="o">=</span> <span class="n">grid_search</span><span class="p">()</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Strategy One"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="c1"># axe.set_title("Strategy One")</span>
<span class="n">outcomes</span><span class="o">.</span><span class="n">losses</span><span class="p">[</span><span class="s2">"Run"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"First"</span>
<span class="n">outcomes_2</span><span class="o">.</span><span class="n">losses</span><span class="p">[</span><span class="s2">"Run"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Second"</span>

<span class="n">outcomes</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"K"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Loss"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"First Run"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<span class="n">outcomes_2</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"K"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Loss"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Second Run"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Objective Function"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="strategy_1_run_one.png" src="strategy_1_run_one.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">outcomes_2</span><span class="o">.</span><span class="n">losses</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">K</th>
<th class="org-right" scope="col">Loss</th>
<th class="org-left" scope="col">Run</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">2833.41</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">2583.62</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">2334.16</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">2060.86</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">2016.25</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">7</td>
<td class="org-right">2050.64</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">8</td>
<td class="org-right">1931.19</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">9</td>
<td class="org-right">1939.68</td>
<td class="org-left">Second</td>
</tr>
<tr>
<td class="org-right">10</td>
<td class="org-right">1839.39</td>
<td class="org-left">Second</td>
</tr>
</tbody>
</table>
<p>It kind of looks like either k=4 or k=5 is the actual optimum (based on the assumption that the biggest drop indicates the right level).</p>
<div class="highlight">
<pre><span></span><span class="n">embedded</span> <span class="o">=</span> <span class="n">plot_clusters</span><span class="p">(</span><span class="n">outcomes_2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="clusters_4.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object>
<div class="highlight">
<pre><span></span><span class="n">embedded</span> <span class="o">=</span> <span class="n">plot_clusters</span><span class="p">(</span><span class="n">outcomes_2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="clusters_5.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object>
<div class="highlight">
<pre><span></span><span class="n">embedded</span> <span class="o">=</span> <span class="n">plot_clusters</span><span class="p">(</span><span class="n">outcomes_2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="clusters_6.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object>
<div class="highlight">
<pre><span></span><span class="n">embedded</span> <span class="o">=</span> <span class="n">plot_clusters</span><span class="p">(</span><span class="n">outcomes_2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="clusters_7.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object>
<div class="highlight">
<pre><span></span><span class="n">embedded</span> <span class="o">=</span> <span class="n">plot_clusters</span><span class="p">(</span><span class="n">outcomes_2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">embedded</span><span class="p">)</span>
</pre></div>
: <object data="clusters_8.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf6415fd">
<h3 id="orgf6415fd">The ID-Specific Data</h3>
<div class="outline-text-3" id="text-orgf6415fd">
<p>For the numeric submission we need to run k-means over the two points that their pre-defined functions produced.</p>
<div class="highlight">
<pre><span></span><span class="n">Submission</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Submission"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"clusters"</span><span class="p">,</span> <span class="s2">"centroids"</span><span class="p">,</span> <span class="s2">"loss"</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">check_centroids</span><span class="p">(</span><span class="n">centroids</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Submission</span><span class="p">:</span>
    <span class="sd">"""Check the outcome with pre-initialized centroids</span>

<span class="sd">    Args:</span>
<span class="sd">     centroids: initial centroids for the k-means algorithm</span>
<span class="sd">     data: points to cluster</span>
<span class="sd">    """</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="n">k_means</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">centroids</span><span class="p">),</span> <span class="n">centroids</span><span class="o">=</span><span class="n">centroids</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">outcome</span><span class="o">.</span><span class="n">clusters</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Submission</span><span class="p">(</span><span class="n">clusters</span><span class="o">=</span><span class="n">outcome</span><span class="o">.</span><span class="n">clusters</span><span class="p">,</span> <span class="n">centroids</span><span class="o">=</span><span class="n">outcome</span><span class="o">.</span><span class="n">centroids</span><span class="p">,</span>
                      <span class="n">loss</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgf5033cd">
<h4 id="orgf5033cd">First Check</h4>
<div class="outline-text-4" id="text-orgf5033cd">
<div class="highlight">
<pre><span></span><span class="n">outcome_3</span> <span class="o">=</span> <span class="n">check_centroids</span><span class="p">(</span><span class="n">centroids</span><span class="o">=</span><span class="n">i_point1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"K: </span><span class="si">{</span><span class="n">k1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Centroids:</span><span class="se">\n</span><span class="si">{</span><span class="n">outcome_3</span><span class="o">.</span><span class="n">centroids</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Objective Function: </span><span class="si">{</span><span class="n">outcome_3</span><span class="o">.</span><span class="n">loss</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
K: 3
Centroids:
[[2.56146449 6.08861338]
 [6.49724962 7.52297293]
 [5.47740039 2.25498103]]

Objective Function: 2526.605733937463
</pre></div>
</div>
<div class="outline-4" id="outline-container-org1de7558">
<h4 id="org1de7558">Second Check</h4>
<div class="outline-text-4" id="text-org1de7558">
<div class="highlight">
<pre><span></span><span class="n">outcome_4</span> <span class="o">=</span> <span class="n">check_centroids</span><span class="p">(</span><span class="n">centroids</span><span class="o">=</span><span class="n">i_point2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"K: </span><span class="si">{</span><span class="n">k2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Centroids:</span><span class="se">\n</span><span class="si">{</span><span class="n">outcome_4</span><span class="o">.</span><span class="n">centroids</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Objective Function: </span><span class="si">{</span><span class="n">outcome_4</span><span class="o">.</span><span class="n">loss</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
K: 5
Centroids:
[[3.22202355 7.15937996]
 [7.49365367 8.52417952]
 [7.55616782 2.23516796]
 [5.37514379 4.53101654]
 [2.68198633 2.09461587]]

Objective Function: 2069.2452603873444
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org94b05e5">
<h3 id="org94b05e5">Sklearn Double check</h3>
<div class="outline-text-3" id="text-org94b05e5">
<div class="highlight">
<pre><span></span><span class="n">kmeans_1</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">i_point1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmeans_1</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">)</span>

<span class="n">clusters_sk_1</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">kmeans_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">clusters_sk_1</span><span class="p">[</span><span class="n">predictions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="n">clusters_sk_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clusters_sk_1</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="p">(</span><span class="n">clusters_sk_1</span><span class="p">))</span>
</pre></div>
<pre class="example">
[[5.47740039 2.25498103]
 [6.49724962 7.52297293]
 [2.56146449 6.08861338]]
2526.605733937463
/home/athena/.virtualenvs/asu-cse-575/lib/python3.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: Explicit initial center position passed: performing only one init in k-means instead of n_init=10
  """Entry point for launching an IPython kernel.
</pre>
<div class="highlight">
<pre><span></span><span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">i_point2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">)</span>

<span class="n">clusters_sk</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">clusters_sk</span><span class="p">[</span><span class="n">predictions</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="n">clusters_sk</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">clusters_sk</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="p">(</span><span class="n">clusters_sk</span><span class="p">))</span>
</pre></div>
<pre class="example">
/home/athena/.virtualenvs/asu-cse-575/lib/python3.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: Explicit initial center position passed: performing only one init in k-means instead of n_init=10
  """Entry point for launching an IPython kernel.
[[7.49365367 8.52417952]
 [3.22202355 7.15937996]
 [7.55616782 2.23516796]
 [2.68198633 2.09461587]
 [5.37514379 4.53101654]]
2069.2452603873444
</pre></div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/clustering/" rel="tag">clustering</a></li>
<li><a class="tag p-category" href="../../categories/project/" rel="tag">project</a></li>
<li><a class="tag p-category" href="../../categories/unsupervised/" rel="tag">unsupervised</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../project-naive-bayes/" rel="prev" title="Project: Naive-Bayes">Previous post</a></li>
<li class="next"><a href="../k-means-clustering-2/" rel="next" title="K-Means Clustering 2">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents Â© 2020 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
